n=100p=.005sick = 1;SIR = zeros(1,n+1);x = 0:n;tau = 1;healthy=n+1;                                              %number of healthy peoplewhile healthy > 1 && sick>0                               %run while there are sick & healthy peoplefor Sz = 0:x(healthy);                                    %potential number of people who don't get sickSIR(1, Sz+1) = [nchoosek(x(healthy), Sz) * (1-p)^(sick*Sz) * (1-(1-p)^sick)^(x(healthy)-Sz)] ;endSIR(1, x(healthy)+2:end) = zeros(1,length(SIR(1, x(healthy)+2:end))); %delete old probabilitiescdf = cumsum(SIR(1,:));u = rand;healthy = 1;while cdf(healthy) <= u %choose an new number of healthy people according to trans.probhealthy = healthy+1;endS(tau) = x(healthy) %new number of healthy people in population +1I(tau) = sick = size(find(SIR),2) - x(healthy) %new number of sick peopletau = tau + 1;end